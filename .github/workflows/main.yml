name: Build ToquiQTT Release

on:
    push:
        branches:
            - main

permissions:
    contents: write

jobs:
    build:
        name: Build and Release ToquiQTT APK
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4

            - uses: actions/setup-java@v3
              with:
                  distribution: "zulu"
                  java-version: "17"
                  cache: "gradle"

            - uses: subosito/flutter-action@v2
              with:
                  channel: "stable"

            - run: flutter pub get

            - run: flutter pub run flutter_launcher_icons

            - run: flutter build apk --release
            - name: Rename APK
              run: mv build/app/outputs/flutter-apk/app-release.apk build/app/outputs/flutter-apk/ToquiQTT-v1.0.0-b${{ github.run_number }}.apk

            - name: Push to Releases
              uses: ncipollo/release-action@v1
              with:
                  artifacts: "build/app/outputs/flutter-apk/ToquiQTT-v1.0.0-b${{ github.run_number }}.apk"
                  tag: v1.0.0-${{ github.run_number }}
                  name: Release v1.0.0 (Build ${{ github.run_number }})
                  body: "Nueva versi√≥n automatizada de ToquiQTT."
                  token: ${{ secrets.GITHUB_TOKEN }}
